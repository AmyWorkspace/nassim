{
    "PageTitle": "load-balance hash-fields mpls",
    "FuncDef": "The load-balance hash-fields mpls command configures a hash factor an interface board uses to perform hash calculation to load-balance MPLS traffic per flow.\nThe undo load-balance hash-fields mpls command restores the default configuration.\nBy default, ip is used as the hash factor an interface board uses to perform hash calculation to load-balance MPLS traffic per flow.",
    "CLIs": [
        "load-balance hash-fields mpls { payload-header | label | ip | ip-tos | mac }",
        "undo load-balance hash-fields mpls"
    ],
    "ParentView": [
        "Slot view"
    ],
    "ParaDef": [
        {
            "Parameters": "label",
            "Info": "Indicates that the hash factor is the label. Hash factors vary with the number of MPLS label layers.\nIf the number of MPLS labels is less than or equal to five, hash factors are all MPLS labels.If the number of MPLS labels is greater than five, hash factors are the five outer most MPLS labels.\n-"
        },
        {
            "Parameters": "ip",
            "Info": "Indicates that the hash factor is the IP address. Hash factors vary with the number of MPLS label layers.\nIf the number of MPLS label layers is less than or equal to five:If an MPLS packet carries an IP packet, the hash factors are the SIP, DIP, SP, DP, and protocol.If an MPLS packet carries an IP packet but not a TCP/UDP packet, the hash factors are the SIP, DIP and protocol.If an MPLS packet carries a non-IP packet, the hash factors are the all MPLS labels.If the number of MPLS label layers is greater than five, the hash factors are the outer most five MPLS labels.\n-"
        },
        {
            "Parameters": "ip-tos",
            "Info": "Load-balances MPLS packets per flow based on the IP and IP ToS value.\nIf the number of MPLS label layers is less than or equal to five:If an MPLS packet carries an IP packet, the hash factors are the SIP, DIP, SP, DP, protocol, and IP ToS.If an MPLS packet carries an no-IP packet, the hash factors are the SIP, DIP, protocol, and IP ToS.If an MPLS packet carries a non-IP packet, the hash factors are all MPLS labels.If the number of MPLS label layers is greater than five, the hash factors are the outer most five MPLS labels.\n-"
        },
        {
            "Parameters": "mac",
            "Info": "Indicates that the hash factor is mac first. If after inner label is not mac:\nHash factors vary with the number of MPLS label layers.If the number of MPLS label layers is less than 5 or equal to 5:\nIf what an MPLS packet carries is an IP TCP/UDP packet, the hash factors are SIP, DIP, SP, DP, and protocol.If what an MPLS packet carries is an IP packet but not a TCP/UDP packet, the hash factors are SIP, DIP and protocol.If what an MPLS packet carries is an non-IP packet, the hash factor is the innermost MPLS label and the first 12 bytes of the payload.\nIf the number of MPLS label layers is larger than 5, the hash factor are the outermost 5 MPLS labels.\n-"
        },
        {
            "Parameters": "payload-header",
            "Info": "Indicates that the hash factor is payload-header.\nIf the number of MPLS label layers is less than or equal to five:\nIf an MPLS packet carries an IP TCP/UDP packet, the hash factors are the SIP, DIP, SP, DP, and protocol.If an MPLS packet carries an IP packet but not a TCP/UDP packet, the hash factors are the SIP, DIP and protocol.If an MPLS packet carries a non-IP packet, the hash factor is the inner most MPLS label and the first 12 bytes of the payload.\nIf the number of MPLS label layers is greater than five, the hash factors are the outer most five MPLS labels.\n-"
        }
    ],
    "Examples": [
        [
            "<HUAWEI> system-view",
            "[~HUAWEI] slot 1",
            "[*HUAWEI-slot-1] load-balance hash-fields mpls payload-header"
        ]
    ],
    "ExtraInfo": "Usage Scenario\nThe load-balance hash-fields mpls command takes effect only on label switching traffic on a transit node of an MPLS tunnel.\nThe load balancing function is implemented using the hash algorithm on the upstream interface board. Traffic is hashed based on traffic characteristics, which are called hash factors. If hash factors are more hashable, traffic will be more evenly load-balanced. The device has default values of the hash factors used for load balancing of different service types of packets. Traffic is load balanced based on the default hash factors depending on the service types of packets on the upstream interface board. To implement load balancing better, configure hash factors based on traffic types.\nThe load-balance hash-fields mpls command is used to adjust the hash factor in MPLS forwarding:\nIf MPLS label-based load balancing has high performance, specify label.If MPLS label-based load balancing has low performance, specify label.\nFor example, if an L2VPN is attached to the AC end of a PE in a large-scale L3VPN, labels of MPLS packets that enter the inbound interface of a P device are the same, but destination MAC addresses encapsulated in the MPLS packets are different. In this case, to perform traffic load balancing on the P device, specify the hash factor as the payload header but not the MPLS label.When MPLS packets carry non-IP packets, specifying the payload-header parameter may cause out-of-order traffic. Therefore, the ip parameter can be used in this case. If different service flows or users use different ToS values in the same IP flow and load balancing is required, you are advised to specify the ip-tos parameter.\n\nConfiguration Impact\nThe dynamic load balancing adjustment function configured using the load-balance dynamic-adjust enable command does not take effect for tunnel interfaces with service classes configured.\nThis command applies only to the LPUF-50/LPUF-50-L/LPUI-21-L/LPUI-51-L/LPUF-51/LPUF-51-B/LPUI-51/LPUI-51-B/LPUI-51-S/LPUS-51/LPUF-101/LPUF-101-B/LPUI-101/LPUI-101-B/LPUS-101/LPUF-51-E/LPUI-51-E/LPUI-51-CM/LPUF-120/LPUF-120-B/LPUF-120-E/LPUI-102-E/LPUI-120/LPUI-120-B/LPUI-120-L/LPUI-52-E/LPUI-120-E/LPUI-120-CM/LPUF-240/LPUF-240-B/LPUF-240-E/LPUI-240/LPUI-240-B/LPUI-240-CM/LPUI-240-L/LPUF-480/LPUF-480-B/LPUI-480/LPUI-480-B/LPUI-480-L/LPUF-480-E/LPUI-480-CM/LPUI-200/LPUI-200-L/LPUF-200/LPUF-200-B/LPUI-1T/LPUI-1T-B/LPUI-1T-L/LPUI-1T-CM/LPUI-2T/LPUI-2T-B/LPUI-2T-CM/LPUF-481/LPUF-402-E/LPUI-241/LPUI-241-B/LPUI-241-CM//LPUF-241/LPUF-241-E/LPUF-52/LPUF-1T-E/LPUI-1T-CM/LPUF-1T-L.\nPrecautions\nWhen the load-balance hash-fields mpls label command is used, if the packet contains the entropy label and the board in the inbound direction is the LPUF-50/LPUF-50-L/LPUI-21-L/LPUI-51-L/LPUF-51/LPUF-51-B/LPUI-51/LPUI-51-B/LPUI-51-S/LPUS-51/LPUF-101/LPUF-101-B/LPUI-101/LPUI-101-B/LPUS-101/LPUF-51-E/LPUI-51-E/LPUI-51-CM/LPUF-120/LPUF-120-B/LPUF-120-E/LPUI-102-E/LPUI-120/LPUI-120-B/LPUI-120-L/LPUI-52-E/LPUI-120-E/LPUI-120-CM/LPUF-240/LPUF-240-B/LPUF-240-E/LPUI-240/LPUI-240-B/LPUI-240-CM/LPUI-240-L/LPUF-480/LPUF-480-B/LPUI-480/LPUI-480-B/LPUI-480-L/LPUF-480-E/LPUI-480-CM/LPUI-200/LPUI-200-L/LPUF-200/LPUF-200-B/LPUI-1T/LPUI-1T-B/LPUI-1T-L/LPUI-1T-CM/LPUI-2T/LPUI-2T-B/LPUI-2T-CM/LPUF-481/LPUF-402-E/LPUI-241/LPUI-241-B/LPUI-241-CM//LPUF-241/LPUF-241-E/LPUF-52/LPUF-1T-E/LPUI-1T-CM/LPUF-1T-L board, the hash algorithm can be performed based on the entropy label if the entropy label is within the 5-layer label. Otherwise, the hash algorithm cannot be performed based on the entropy label.\nIn VS mode, this command is supported only by the admin VS."
}