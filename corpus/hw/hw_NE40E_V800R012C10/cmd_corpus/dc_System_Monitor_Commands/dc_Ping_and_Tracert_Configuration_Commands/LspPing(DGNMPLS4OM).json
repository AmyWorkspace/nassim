{
    "PageTitle": "ping lsp (General)",
    "FuncDef": "The ping lsp command tests whether the LSP connectivity and LSP forwarding are normal.",
    "CLIs": [
        "ping lsp [ -a <source-ip> | -c <count> | -exp <exp-value> | -h <ttl-value> | -m <interval> | -r <reply-mode> | -s <packet-size> | -t <time-out> | -v | -g ] * ip <destination-iphost> <mask-length> [ <ip-address> ] [ nexthop <nexthopAddr> ] [ remote <remoteAddress> ]",
        "ping lsp [ -a <source-ip> | -c <count> | -exp <exp-value> | -h <ttl-value> | -m <interval> | -r <reply-mode> | -s <packet-size> | -t <time-out> | -v | -g ] * te { { <tunnelName> | <ifType> <ifNum> } [ hot-standby | primary ] [ compatible-mode ] | auto-tunnel <autoTunnelName> }",
        "ping lsp [ -a <source-ip> | -c <count> | -exp <exp-value> | -h <ttl-value> | -m <interval> | -s <packet-size> | -t <time-out> | -v | -g | -r <reply-mode> ] * segment-routing { { auto-tunnel <srAutoTnlName> [ version { draft2 | draft4 } ] } | te { <tunnelName> | <ifType> <ifNum> } [ draft2 ] } [ remote <remoteAddress> ] [ hot-standby | primary ]",
        "ping lsp [ -a <source-ip> | -c <count> | -exp <exp-value> | -h <ttl-value> | -m <interval> | -s <packet-size> | -t <time-out> | -g ] * general labels [ <mplsLabel1> [ <mplsLabel2> [ <mplsLabel3> [ <mplsLabel4> [ <mplsLabel5> [ <mplsLabel6> [ <mplsLabel7> [ <mplsLabel8> [ <mplsLabel9> [ <mplsLabel10> [ <mplsLabel11> [ <mplsLabel12> [ <mplsLabel13> ] ] ] ] ] ] ] ] ] ] ] ] ] -i { <outIfName> | <outIfType> <outIfNum> } nexthop <nexthopAddr>"
    ],
    "ParentView": [
        "All views"
    ],
    "ParaDef": [
        {
            "Parameters": "-a source-ip",
            "Info": "Specifies the source address of an MPLS Echo Request packet to be sent.\nIf no source address is specified, the MPLS LSR-ID through which an MPLS Echo Request packet is sent will be used.\nThe value is in dotted decimal notation."
        },
        {
            "Parameters": "-c count",
            "Info": "Specifies the number of times an MPLS Echo Request packet will be sent.\nIn the case of a poor network quality, you can set this parameter to a comparatively large value to test the network quality based on the packet loss percentage.\nThe value is an integer ranging from 1 to 4294967295."
        },
        {
            "Parameters": "-exp exp-value",
            "Info": "Specifies an EXP value of the MPLS Echo Request packet to be sent.\nThe value is an integer ranging from 0 to 7."
        },
        {
            "Parameters": "-h ttl-value",
            "Info": "Specifies a TTL value.\nIf the TTL value in a packet is reduced to 0 during forwarding, the router that receives the packet sends a timeout packet to the source, indicating that the destination is unreachable.\nThe value is an integer ranging from 1 to 255."
        },
        {
            "Parameters": "-m interval",
            "Info": "Specifies an interval at which MPLS Echo Request packets are sent.\nThe value is an integer that ranges from 1 to 10000, in milliseconds."
        },
        {
            "Parameters": "-r reply-mode",
            "Info": "Specifies a mode in which the peer sends MPLS Echo Reply packets in response.\nThe value is an integer ranging from 1 to 4.The default value is 2.\n1: no reply.\n2: reply with an IPv4 or IPv6 UDP packet.\n3: reply with an IPv4 or IPv6 UDP packet carrying the router-alert option.\n4: reply through the control channel of the application plane."
        },
        {
            "Parameters": "-s packet-size",
            "Info": "Specifies a packet payload length, excluding the IP header and UDP header.\nThe value is an integer ranging from 65 to 9600, in bytes."
        },
        {
            "Parameters": "-t time-out",
            "Info": "Specifies a timeout period for waiting for an MPLS Echo Reply packet after an MPLS Echo Request packet is sent.\nThe value is an integer ranging from 0 to 65535, in milliseconds."
        },
        {
            "Parameters": "-v",
            "Info": "Displays verbose output.\n-"
        },
        {
            "Parameters": "-g",
            "Info": "Performs the test using MPLS fragments.\n-"
        },
        {
            "Parameters": "ip destination-iphost",
            "Info": "Specifies an IPv4 address or host name for the destination.\nIf the value is an IP address, it is in dotted decimal notation. If the value is a host name, it is a string of 1 to 255 case-sensitive characters, spaces not supported."
        },
        {
            "Parameters": "mask-length",
            "Info": "Specifies a mask length for the destination.\nThe value is an integer ranging from 0 to 32."
        },
        {
            "Parameters": "ip-address",
            "Info": "Specifies the destination address in the IP header of an MPLS ping packet with the prefix of 127.0.0.0/8.\nThe destination address in the IP header can be changed to trace a test packet.\nBy default, the destination IP address carried in the IP header of an MPLS ping packet is 127.0.0.1."
        },
        {
            "Parameters": "nexthop nexthopAddr",
            "Info": "Specifies a next hop address. When links implement load balancing, this parameter can be used to locate the next-hop address.\nThe value is in dotted decimal notation."
        },
        {
            "Parameters": "remote remoteAddress",
            "Info": "Specifies the IP address of the L3VPN remote PE.\nThe value is in dotted decimal notation."
        },
        {
            "Parameters": "te tunnelName",
            "Info": "Specifies the name of the TE tunnel interface.\n-"
        },
        {
            "Parameters": "ifType",
            "Info": "Specifies the type of the interface.\n-"
        },
        {
            "Parameters": "ifNum",
            "Info": "Specifies the number of the interface.\n-"
        },
        {
            "Parameters": "hot-standby",
            "Info": "Specifies the checking of the hot-standby lsp of the tunnel.\n-"
        },
        {
            "Parameters": "primary",
            "Info": "Specifies the checking of the primary lsp of the tunnel.\n-"
        },
        {
            "Parameters": "compatible-mode",
            "Info": "Specifies the compatible mode of intercommunication.\n-"
        },
        {
            "Parameters": "auto-tunnel autoTunnelName",
            "Info": "Specify auto tunnel name.\nThe value is a string of 1 to 31 case-sensitive characters, spaces not supported."
        },
        {
            "Parameters": "auto-tunnel srAutoTnlName",
            "Info": "Specifies the name of te auto tunnel interface.\nThe value is a string of 1 to 255 case-sensitive characters, spaces not supported."
        },
        {
            "Parameters": "segment-routing",
            "Info": "Specifies an segment routing tunnel.\n-"
        },
        {
            "Parameters": "version",
            "Info": "Specifies the protocol version.\n-"
        },
        {
            "Parameters": "draft2",
            "Info": "Specifies the protocol version being draft2.\n-"
        },
        {
            "Parameters": "draft4",
            "Info": "Specifies the protocol version being draft4.\n-"
        },
        {
            "Parameters": "general",
            "Info": "Specifies a general lspping.\n-"
        },
        {
            "Parameters": "labels mplsLabel1",
            "Info": "Specifies an MPLS label.\nThe value is an integer ranging from 0 to 1048575."
        },
        {
            "Parameters": "mplsLabel2",
            "Info": "Specifies an MPLS label.\nThe value is an integer ranging from 0 to 1048575."
        },
        {
            "Parameters": "mplsLabel3",
            "Info": "Specifies an MPLS label.\nThe value is an integer ranging from 0 to 1048575."
        },
        {
            "Parameters": "mplsLabel4",
            "Info": "Specifies an MPLS label.\nThe value is an integer ranging from 0 to 1048575."
        },
        {
            "Parameters": "mplsLabel5",
            "Info": "Specifies an MPLS label.\nThe value is an integer ranging from 0 to 1048575."
        },
        {
            "Parameters": "mplsLabel6",
            "Info": "Specifies an MPLS label.\nThe value is an integer ranging from 0 to 1048575."
        },
        {
            "Parameters": "mplsLabel7",
            "Info": "Specifies an MPLS label.\nThe value is an integer ranging from 0 to 1048575."
        },
        {
            "Parameters": "mplsLabel8",
            "Info": "Specifies an MPLS label.\nThe value is an integer ranging from 0 to 1048575."
        },
        {
            "Parameters": "mplsLabel9",
            "Info": "Specifies an MPLS label.\nThe value is an integer ranging from 0 to 1048575."
        },
        {
            "Parameters": "mplsLabel10",
            "Info": "Specifies an MPLS label.\nThe value is an integer ranging from 0 to 1048575."
        },
        {
            "Parameters": "mplsLabel11",
            "Info": "Specifies an MPLS label.\nThe value is an integer ranging from 0 to 1048575."
        },
        {
            "Parameters": "mplsLabel12",
            "Info": "Specifies an MPLS label.\nThe value is an integer ranging from 0 to 1048575."
        },
        {
            "Parameters": "mplsLabel13",
            "Info": "Specifies an MPLS label.\nThe value is an integer ranging from 0 to 1048575."
        },
        {
            "Parameters": "-i outIfName",
            "Info": "Specifies the name of the interface.\n-"
        },
        {
            "Parameters": "outIfType",
            "Info": "Specifies the type of the interface.\n-"
        },
        {
            "Parameters": "outIfNum",
            "Info": "Specifies the number of the interface.\n-"
        }
    ],
    "Examples": [
        [
            "<HUAWEI> ping lsp -c 10 -s 200 ip 4.4.4.9 32",
            "  LSP PING FEC: IPV4 PREFIX 4.4.4.9/32 : 200 data bytes, press CTRL_C to break",
            "    Reply from 4.4.4.9: bytes=200 Sequence=1 time = 11 ms",
            "    Reply from 4.4.4.9: bytes=200 Sequence=2 time = 6 ms",
            "    Reply from 4.4.4.9: bytes=200 Sequence=3 time = 6 ms",
            "    Reply from 4.4.4.9: bytes=200 Sequence=4 time = 6 ms",
            "    Reply from 4.4.4.9: bytes=200 Sequence=5 time = 12 ms",
            "    Reply from 4.4.4.9: bytes=200 Sequence=6 time = 9 ms",
            "    Reply from 4.4.4.9: bytes=200 Sequence=7 time = 12 ms",
            "    Reply from 4.4.4.9: bytes=200 Sequence=8 time = 9 ms",
            "    Reply from 4.4.4.9: bytes=200 Sequence=9 time = 12 ms",
            "    Reply from 4.4.4.9: bytes=200 Sequence=10 time = 12 ms",
            "  --- FEC: IPV4 PREFIX 4.4.4.9/32 ping statistics ---",
            "    10 packet(s) transmitted",
            "    10 packet(s) received",
            "    0.00% packet loss",
            "    round-trip min/avg/max = 6/10/12 ms"
        ]
    ],
    "ExtraInfo": "Usage Scenario\nThe ping lsp command can be used to check the connectivity of LSPs on an MPLS network, and the tracert lsp command can be used to locate the faulty node.\nThe ping lsp command uses MPLS Echo Request packets and MPLS Echo Reply packets to detect the connectivity of LSPs. Both Echo Request and Echo Reply packets are transmitted in the format of UDP packets with the port number being 3503. The receiver distinguishes these two types of packets from other packets based on the port number. An MPLS Echo Request packet carries FEC information to be detected, and is sent along the same LSP as other packets carrying the same FEC information. In this manner, the connectivity of the LSP is checked. Echo Request packets are transmitted to the destination using MPLS, whereas MPLS Echo Reply packets are transmitted to the source using IP.\nThe ping lsp command can be used to check links of the following types:\nLDP LSP: You can run the ping lsp -c count -s packet-size ip destination-iphost mask-length command on the ingress to ping the egress to check the connectivity of an LSP. If multiple tunnels are set on an ingress node for load balancing, you can use the nexthop parameter to specify the next hop for checking the connectivity of a specified LSP.TE tunnel: If a tunnel exists, you can run the ping lsp teinterface-number command on the ingress to ping the egress to check the connectivity of the tunnel.TE auto tunnel: If an auto tunnel exists, run the ping lsp te auto-tunnel auto-tunnelname command to initiate a ping test from the ingress node to the egress node to check the connectivity of the tunnel.SR-MPLS TE IPv4 ping: If the type of tunnels to be tested is SR-MPLS TE IPv4:To test the connectivity of an SR-MPLS TE tunnel dynamically created, run the ping lsp [ -a source-ip | -c count | -exp exp-value | -h ttl-value | -m interval | -s packet-size | -t time-out | -v | -g ] * segment-routing auto-tunnel auto-tunnelname version { draft2 | draft4 } [ remote remote-address ] [ hot-standby ] command and specify auto-tunnelname on the ingress to initiate a ping test to the egress.To test the connectivity of an SR-MPLS TE IPv4 tunnel manually configured, run the ping lsp [ -a source-ip | -c count | -exp exp-value | -h ttl-value | -m interval | -s packet-size | -t time-out | -v | -g ] * segment-routing te Tunnel interface-number [ draft2 ] [ remote remote-address ] [ hot-standby ] command to initiate a ping test to the egress.General LSP ping detection: Specify the outbound interface, next hop, and label information on the ingress, and run the ping lsp general labels command to test the connectivity of LSPs.LDP LSP connected with an SR-MPLS BE tunnel ping: To test the connectivity of an LDP LSP connected with an SR-MPLS BE tunnel, run the ping lsp [ -a source-ip | -c count | -exp exp-value | -h ttl-value | -m interval | -r reply-mode | -s packet-size | -t time-out | -v | -g ] * ip destination-iphost mask-length [ ip-address ] [ nexthop nexthop-address ] [ remote remote-address ] command on the ingress to initiate a ping test to the egress of the SR-MPLS BE tunnel.LDP LSP connected with an SR-MPLS BE tunnel ping: If the LDP side does not support interworking, to test the connectivity of an LDP LSP connected with an SR-MPLS BE tunnel, run the ping lsp [ -a source-ip | -c count | -exp exp-value | -h ttl-value | -m interval | -r reply-mode | -s packet-size | -t time-out | -v | -g ] * ip destination-iphost mask-length [ ip-address ] [ nexthop nexthop-address ] [ remote remote-address ] command on the ingress to initiate a ping test to the egress of the SR-MPLS BE tunnel.\nYou must run the lspv echo-reply fec-validation ldp disable command on the SR-MPLS BE side to disable the LSPV response end from checking the LDP FEC.\nIf a fault occurs when an LSP is detected using the ping lsp command, and packets transmitted along this LSP cannot reach the egress, you can run the tracert lsp command to locate the fault. Both the LSP ping test and the LSP tracert test can check the connectivity of LSPs and locate faults. In practice, when a fault occurs on the MPLS forwarding path, causing traffic on an LSP to be interrupted, you can use the LSP ping and LSP tracert tests for fault location.\n\nPrerequisites\nBefore running the ping lsp command, ensure that the MPLS module has been enabled and is working properly.\nConfiguration Impact\nTo prevent the egress from forwarding a received MPLS Echo Request packet to other nodes, you can set the destination address in the IP header of the packet to 127.0.0.1/8 (the local loopback address) and the TTL value to 1.\nPrecautions\nDuring an L3VPN LSP ping test, if the destination of a ping operation is a CE address, the ping can succeed even when the link between the CE and PE is faulty, because it is the end-to-end link between PEs that is detected."
}