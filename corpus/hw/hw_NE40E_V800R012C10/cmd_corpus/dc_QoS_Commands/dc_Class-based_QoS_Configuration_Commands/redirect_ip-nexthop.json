{
    "PageTitle": "redirect ip-nexthop",
    "FuncDef": "The redirect ip-nexthop command assigns the IP address and configures the outbound interface, an NQA instance, and a VPN test instace of the next hop for redirection. After the traffic policy in which this redirection action is specified is applied to an interface, the traffic matching the traffic policy is redirected based on the action.\nThe undo redirect ip-nexthop command cancels the configuration.\nBy default, the IP address, outbound interface, an NQA instance, and a VPN test instance are not configured in the traffic behavior view for the next hop for redirection.",
    "CLIs": [
        "redirect ip-nexthop <ip-address> vpn <vpn-name> [ nqa <nqa-test-administer-name> <name-of-nqa-test-instance> ] [ routing-filter { default-routing | blackhole-routing } * ] [ deny ] [ pri-type common ]",
        "redirect ip-nexthop <ip-address> nqa <nqa-test-administer-name> <name-of-nqa-test-instance> [ routing-filter { default-routing | blackhole-routing } * ] [ deny ] [ pri-type common ] [ public-network ]",
        "redirect ip-nexthop <ip-address> [ routing-filter { default-routing | blackhole-routing } * ] [ deny ] [ pri-type common ] [ public-network ]",
        "redirect ip-nexthop <ip-address> interface { <interface-name> | <interface-type> <interface-number> } [ route-forward ] [ pri-type common ]",
        "redirect ip-nexthop <ip-address> nqa <nqa-test-administer-name> <name-of-nqa-test-instance> [ routing-filter { default-routing | blackhole-routing } * ] [ deny ] [ pri-type common ]",
        "redirect ip-nexthop <ip-address> [ routing-filter { default-routing | blackhole-routing } * ] [ deny ] [ pri-type common ]",
        "redirect ip-nexthop <ip-address> [ nqa <nqa-test-administer-name> <name-of-nqa-test-instance> ] [ deny ] [ pri-type common ] [ vpn-network ]",
        "undo redirect ip-nexthop"
    ],
    "ParentView": [
        "Traffic behavior view"
    ],
    "ParaDef": [
        {
            "Parameters": "ip-address",
            "Info": "Specifies the IP address of the next hop for redirection.\nWhen ip-nexthop is specified, the value is an IPv4 address in dotted decimal notation, for example, 10.1.1.1."
        },
        {
            "Parameters": "vpn vpn-name",
            "Info": "Specifies the name of a VPN instance.\nThe value is a string of 1 to 31 case-sensitive characters, spaces not supported. In addition, the VPN instance name must not be _public_. When double quotation marks are used around the string, spaces are allowed in the string."
        },
        {
            "Parameters": "nqa nqa-test-administer-name",
            "Info": "Specifies the name of an NQA test instance.\nThe name is a string of 1 to 32 case-insensitive characters, spaces not supported.The string can contain spaces if it is enclosed with double quotation marks (\")."
        },
        {
            "Parameters": "name-of-nqa-test-instance",
            "Info": "Specifies the name of a manager of an NQA test instance.\nThe name is a string of 1 to 32 case-insensitive characters, spaces not supported.The string can contain spaces if it is enclosed with double quotation marks (\")."
        },
        {
            "Parameters": "routing-filter blackhole-routing",
            "Info": "When this parameter is configured, if the IP address of the next hop matches a black-hole route, the packets are forwarded based on their destination IP address.\n-"
        },
        {
            "Parameters": "routing-filter default-routing",
            "Info": "When this parameter is configured, if the IP address of the next hop matches the default route, the packets are forwarded based on their destination IP address.\n-"
        },
        {
            "Parameters": "default-routing",
            "Info": "Indicates a default route.\n-"
        },
        {
            "Parameters": "blackhole-routing",
            "Info": "Indicates a black-hole route.\n-"
        },
        {
            "Parameters": "deny",
            "Info": "If the next hop does not exist, the packet is discarded.\n-"
        },
        {
            "Parameters": "pri-type common",
            "Info": "Specifies the route priorities so that common routes take precedence. To be specific, when the destination IP address of a packet is reachable, the packet is forwarded preferentially based on the destination IP address. When the destination IP address of a packet is unreachable, the packet is forwarded based on policy-based routing.\n-"
        },
        {
            "Parameters": "interface interface-type interface-number",
            "Info": "Specifies the type and number of an interface or an interface name.\n-"
        },
        {
            "Parameters": "route-forward",
            "Info": "If a discard PBR policy is enabled in this command, and all the specified outbound interfaces were shut down, the parameter route-forward can be configured to return packets to the original forwarding process.\n-"
        },
        {
            "Parameters": "vpn-network",
            "Info": "When a forward PBR policy is configured on a private network interface (non-VPN scenario) and no public IP address exists, traffic can be redirected to the private network.\n-"
        }
    ],
    "Examples": [
        [
            "<HUAWEI> system-view",
            "[~HUAWEI] traffic behavior b1",
            "[*HUAWEI-behavior-b1] redirect ip-nexthop 1.1.1.1 interface GigabitEthernet 1/0/0"
        ],
        [
            "<HUAWEI> system-view",
            "[~HUAWEI] ip vpn-instance vpna",
            "[*HUAWEI-vpn-instance-vpna] quit",
            "[*HUAWEI] traffic behavior f1",
            "[*HUAWEI-behavior-f1] redirect ip-nexthop 1.1.1.1 vpn vpna"
        ],
        [
            "<HUAWEI> system-view",
            "[~HUAWEI] nqa test-instance AIS AIS_PM4800",
            "[*HUAWEI-nqa-AIS-AIS_PM4800] quit",
            "[*HUAWEI] traffic behavior e1",
            "[*HUAWEI-behavior-e1] redirect ip-nexthop 1.1.1.1 nqa AIS AIS_PM4800"
        ]
    ],
    "ExtraInfo": "Usage Scenario\nTraffic can be forwarded to a specified next hop instead of being forwarded based on the route on a network. If this is required by users, redirection must be deployed on the network.\nIf an outbound interface is specified for redirection in a traffic behavior, a discard PBR policy is configured. If no outbound interface is specified for redirection in a traffic behavior, a forward PBR policy is configured.\nWhen a discard PBR policy is configured, packets are forwarded to the specified next hop and outbound interface, with no FIB entries being searched for. The details of the procedure are as follows:\nIf the interface is Up, traffic is redirected to the outbound interface.\nIf the next hop is reachable, traffic is forwarded successfully.If the next hop is unreachable, traffic is discarded.\nIf the interface is Down, traffic is discarded.\nThe route-forward parameter can be configured in a scenario in which a discard PBR policy is configured to redirect packets to a single next hop. If a discard PBR policy and route-forward are configured and the next hop interface is Down, packets are forwarded based on the FIB entry information obtained through the destination IP address of the packets.\nWhen a forward PBR policy is configured, if only the IP address of the next hop is specified on an interface, the interface searches the next-hop IP address of packets against the public-network FIB table. If the IP address of the next hop and VPN are specified on an interface, the interface searches the next-hop IP address and VPN information of packets against the private-network FIB table.\nIf one matching entry is found in the FIB table, the interface redirects the packets based on the matching entry information.If no matching entry is found in the FIB table, the interface searches the destination IP address of packets against the FIB table.\nIf one matching entry is found in the FIB table, the interface redirects the packets based on the matching entry information.If no matching entry is found in the FIB table, the interface discards the packets.\nIn a scenario in which a forward PBR policy is configured to redirect packets to a single next hop, by default, packets are forwarded based on the next hop of the default route if the IP address of the next hop matches the default route; packets are dropped if the IP address of the next hop matches a black-hole route.\nThe routing-filter { default-routing | blackhole-routing } parameter can be configured in a scenario in which a forward PBR policy is configured to redirect packets to a single next hop. When this parameter is configured, if the IP address of the next hop matches the default route or a black-hole route, the packets are forwarded based on their destination IP address.\n\nPrecautions\nThe policy-based routing and IPv6 redirection cannot be both configured in one traffic behavior.\nThe policy-based routing and IPv4 redirection cannot be both configured in one traffic behavior.\nThe policy-based routing and NAT traffic distribution are mutually exclusive in one traffic behavior.\nPolicy-based routing does not support redirection for Layer 2 forwarded traffic.\nTo switch between discard and forward PBR policies, delete the original policy and reconfigure the other one.\nAssociating redirection with NQA test ensures that the IP address of the next hop for redirection is reachable. The type of the NQA test instance must be ICMP. To implement real-time check on the reachability of the next hop for redirection, enable the NQA test instance to perform periodical check.\nThe IP address of the next hop to which traffic is redirected takes effect only when the NQA test instance is successfully complete.\nThe redirect nexthop address must match the network segment of the outbound interface.\nPolicy-based routing supports redirection only for incoming traffic. MF classification configured for outgoing traffic does not take effect."
}